{% extends "layouts/base.html" %}

{% block title %} Transactions {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}


  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center py-4">
      <div class="d-block mb-4 mb-md-0">
          <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
              <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
                  <li class="breadcrumb-item">
                      <a href="#">
                          <svg class="icon icon-xxs" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                      </a>
                  </li>
                  <li class="breadcrumb-item"><a href="#">Leaffit</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Fitness Goals</li>
              </ol>
          </nav>
      </div>
  </div>
  
 <div class="container">
    <h1>Backend Proficiency Calculator</h1>
    <p>Recommended Score: 50</p>

    <form method="POST" id="proficiency-form" class="mb-4">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary btn-block">Calculate Score</button>
    </form>

    <div id="results" class="mb-5">
        <h2>Total Score: {{ total_score }}</h2>
        <ul>
            {% for category, level, weight in selected_levels %}
                <li>{{ category }} ({{ level }}) - {{ weight }} points</li>
            {% endfor %}
        </ul>
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Category</th>
                <th>Beginner</th>
                <th>Intermediate</th>
                <th>Advanced</th>
                <th>Expert</th>
                <th>Weight</th>
            </tr>
        </thead>
        <tbody>
            {% for skill in skills %}
            <tr>
                <td>{{ skill.name }}</td>
                <td>{{ skill.beginner }}</td>
                <td>{{ skill.intermediate }}</td>
                <td>{{ skill.advanced }}</td>
                <td>{{ skill.expert }}</td>
                <td>
                    <select name="weight_{{ skill.id }}" class="form-select" id="weight-{{ skill.id }}">
                        {% for i in range %}
                        <option value="{{ i }}" {% if i == skill.weight %}selected{% endif %}>{{ i }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- JavaScript to handle form submission and dynamic score calculation -->
<script>
// Handle form submission with AJAX
document.getElementById('proficiency-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = this;
    const formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.text())
    .then(data => {
        // Update the results section with the new score
        document.getElementById('results').innerHTML = data;
    });
});

// Handle real-time score calculation based on selected weights
document.querySelectorAll('select').forEach(select => {
    select.addEventListener('change', function() {
        let totalScore = 0;
        document.querySelectorAll('select').forEach(s => {
            const selectedOption = s.options[s.selectedIndex];
            const weight = s.getAttribute('data-weight') || 0;
            if (selectedOption) {
                totalScore += parseInt(selectedOption.value);
            }
        });
        document.getElementById('total-score').textContent = totalScore;
    });
});
</script>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->